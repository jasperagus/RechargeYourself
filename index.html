<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Recharge Pyramid</title>
  <link rel="stylesheet" href="index.css">
  <script defer src="eventHandler.js"></script>
  <script defer src="script.js"></script>
  <script defer src="renderer.js"></script>
  <script defer src="preload.js"></script>
</head>
<body>
  <div id="project_container">
    <div id="projectbox">
      <!-- Start project HTML -->
      <div class="battery-container">
        <div class="battery">
          <div class='bar' data-power='10'></div>
          <div class='bar' data-power='20'></div>
          <div class='bar' data-power='30'></div>
          <div class='bar' data-power='40'></div>
          <div class='bar' data-power='50'></div>
          <div class='bar' data-power='60'></div>
          <div class='bar' data-power='70'></div>
          <div class='bar' data-power='80'></div>
          <div class='bar' data-power='90'></div>
          <div class='bar' data-power='100'></div>
        </div>
      </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="script.js"></script>

    <div class="music-player">
      <button hidden id="btnPlayPause">Play</button>
      <input type="range" id="seekBar" min="0" value="0" step="1">
      <div id="timerDisplay">00:00</div>
    </div>

    <button id="btn1" class="clickable1 btn">1. Korte Relaxsessie - 12:15 min</button>
    <button id="btn2" class="clickable2 btn">2. Diepe ontspanning - 26:14 min</button>
    <button id="btn3" class="clickable3 btn">3. Meer rust in je hoofd - 20:49 min</button>
    <button id="btn4" class="clickable4 btn">4. Beter slapen - 20:10 min</button>
    <button id="btn5" class="clickable5 btn">5. Sublimale muzieksessie - 15:00 min</button>
    <button id="btn6" class="clickable6 btn">6. Recharge sessie - 15:00 min</button>
    <button id="btn7" class="clickable7 btn">7. Jezelf opladen - 16:31 min</button>
    <button id="btn8" class="clickable8 btn">8. Loslaten negatieve emoties - 18.42 min</button>
    <button id="btn9" class="clickable9 btn">9. Emotionele balans - 17.02 min</button>
    <button id="btn10" class="clickable10 btn">10. Beter eetpatroon - 18:58 min</button>
    <button id="videoPlayerButton" class="clickable11 btn"></button>

    <div id="blankSquarePopup" style="display: none;">
      <div class="popupContent">
        <button class="closeButton" onclick="toggleBlankSquarePopup()">X</button>
        <div class="welcomeMessage">
          <p>Welcome to <span style="font-weight: bold;">Recharge Yourself!</span></p>
        </div>
        <div class="questionsContainer">
          <h4>Hoe voelde je je voorafgaande aan deze sessie?</h4>
          <form id="rechargeForm">
            <input type="checkbox" id="feeling1" name="feeling" value="Gestrest">
            <label for="feeling1">1. Gestrest</label><br>
            <input type="checkbox" id="feeling2" name="feeling" value="Futloos">
            <label for="feeling2">2. Futloos</label><br>
            <input type="checkbox" id="feeling3" name="feeling" value="Somber">
            <label for="feeling3">3. Somber</label><br>
            <input type="checkbox" id="feeling4" name="feeling" value="Energiek">
            <label for="feeling4">4. Energiek</label><br>
            <input type="checkbox" id="feeling5" name="feeling" value="Neutraal">
            <label for="feeling5">5. Neutraal</label><br>

            <h4>Afhankelijk van de keuze uit vraag 1 is het nu erger/slechter/minder of beter?</h4>
            <input type="checkbox" id="impact1" name="impact" value="Erger">
            <label for="impact1">1. Erger</label><br>
            <input type="checkbox" id="impact2" name="impact" value="Slechter">
            <label for="impact2">2. Slechter</label><br>
            <input type="checkbox" id="impact3" name="impact" value="Minder">
            <label for="impact3">3. Minder</label><br>
            <input type="checkbox" id="impact4" name="impact" value="Beter">
            <label for="impact4">4. Beter</label><br>
            <input type="checkbox" id="impact5" name="impact" value="Veel beter">
            <label for="impact5">5. Veel beter</label><br>

            <h4>Neem je een pauze van je werk?</h4>
            <input type="checkbox" id="pauseYes" name="pause" value="Ja">
            <label for="pauseYes">1. Ja</label><br>
            <input type="checkbox" id="pauseNo" name="pause" value="Nee">
            <label for="pauseNo">2. Nee</label><br>

            <h4>Heb je vandaag gezond gegeten?</h4>
            <input type="checkbox" id="healthyYes" name="healthy" value="Ja">
            <label for="healthyYes">1. Ja</label><br>
            <input type="checkbox" id="healthyNo" name="healthy" value="Nee">
            <label for="healthyNo">2. Nee</label><br>
          </form>
        </div>
        <button class="submitButton" onclick="submitForm()">Submit</button>
      </div>
    </div>
  </div>

  <div id="videoPlayerPopup" class="video-player-popup">
    <header>
      <button onclick="toggleVideoPopup()">X</button>
    </header>
    <div class="player-body">
      <video id="videoPlayer" controls>
        <source src="../images/MainManRick.mp4" type="video/mp4">
        Your browser does not support the video tag.
      </video>
    </div>
  </div>

  <script>
    function toggleBlankSquarePopup(text, showQuestions) {
      const blankSquarePopup = document.getElementById("blankSquarePopup");
      const popupContent = blankSquarePopup.querySelector(".popupContent");
      const popupText = popupContent.querySelector("p");
      const questionsContainer = popupContent.querySelector(".questionsContainer");
      popupText.textContent = text; // Set the text content dynamically
      blankSquarePopup.style.display = blankSquarePopup.style.display === "block" ? "none" : "block";
      questionsContainer.style.display = showQuestions ? "block" : "none";
    }

    function submitForm() {
      const form = document.getElementById('rechargeForm');
      const formData = new FormData(form);
      const csvContent = [];

      // Transpose the form data to save vertically
      const formDataArray = Array.from(formData.entries());
      const transposedFormData = formDataArray.reduce((acc, [name, value]) => {
        if (!acc[name]) {
          acc[name] = [value];
        } else {
          acc[name].push(value);
        }
        return acc;
      }, {});

      // Iterate through each form field and value
      Object.entries(transposedFormData).forEach(([name, values]) => {
        csvContent.push(`${name}:`);
        values.forEach(value => {
          csvContent.push(value);
        });
      });
      csvContent.push('\n'); 

      // Join with newline characters for proper CSV format
      const csvData = csvContent.join('\n');

      // Require Electron's remote module
      const { remote } = require('electron');
      const fs = remote.require('fs');
      const path = require('path');

      // Determine the file path for saving
      const filePath = 'C:\\Users\\jkors\\Dropbox\\RechargeCocoon_data\\RechargeCocoon_test_jasper\\survey_results.csv';

      // Append the CSV data to the file
      fs.appendFile(filePath, csvData + '\n', (err) => {
        if (err) {
          console.error('Error appending to file:', err);
          return;
        }
        console.log('Data successfully appended to file:', filePath);
      });

      // Reset the form
      form.reset();
    }

    window.onload = function() {
      toggleBlankSquarePopup();
    };
  </script>
</body>
</html>
